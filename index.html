<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ... (без изменений в head) ... -->
</head>
<body>
  <!-- ... (без изменений в layout и controls) ... -->

  <script>
    // ... (карта, иконки, locate, zoom и т.д.) ...

    function createManagedPopup(streamUrl) {
      const container = document.createElement('div');
      container.className = 'video-popup';
      const video = document.createElement('video');
      video.controls = true; video.autoplay = false; video.muted = true; video.playsInline = true;
      container.appendChild(video);
      let hlsInstance;
      container.onPopupOpen = () => {
        if (Hls.isSupported()) {
          hlsInstance = new Hls();
          hlsInstance.loadSource(streamUrl);
          hlsInstance.attachMedia(video);
          hlsInstance.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else {
          video.src = streamUrl;
          video.onloadedmetadata = () => video.play();
        }
      };
      container.onPopupClose = () => {
        if (hlsInstance) { hlsInstance.destroy(); hlsInstance = null; }
        video.pause();
        video.removeAttribute('src');
        video.load();
      };
      return container;
    }

    const markers = [
      { id: 'OFFICE', address: '300 North 3rd Street, Burbank, CA', url: '/hls/cam1.m3u8', type: 'building' },
      { id: 'BBQ', lat: 34.1601849437365, lng: -118.25466125331505, url: '/hls/cam2.m3u8', type: 'food' },
      { id: '5STAR', address: '8230 Allott Ave, Panorama City, CA 91402', url: '/hls/cam3.m3u8', type: 'laundry' },
      { id: "Trader Jo's", lat: 34.15995908795789, lng: -118.25430964670682, url: '/hls/cam5.m3u8', type: 'food' },
      { id: 'Master BBQ', lat: 34.1466666667, lng: -118.2627777778, url: '/hls/cam6.m3u8', type: 'food' },
      { id: 'BJ-1', lat: 34.20205288034795, lng: -118.40886141624648, url: '/hls/cam8.m3u8', type: 'parking' },
      { id: 'BJ-2', lat: 34.20205288034795, lng: -118.40886141624648, url: '/hls/cam9.m3u8', type: 'parking' },
      { id: 'Home', lat: 34.207930027750535, lng: -118.36923043862326, url: '/hls/cam10.m3u8', type: 'building' },
      { id: 'Meat master', lat: 34.19412745338414, lng: -118.36468680858975, url: '/hls/cam11.m3u8', type: 'food' },
    ];

    // ... (остальной JS: fitBounds, bindPopup, tooltip, поиск и т.д.) ...
  </script>
</body>
</html>
