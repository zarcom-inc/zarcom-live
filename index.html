<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zarcom Cameras Map with Archive</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; }
    header.site-header { position: absolute; top: 0; left: 0; width: 100%; height: 60px; background: #333; color: #fff; display: flex; align-items: center; padding: 0 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); z-index: 1200; }
    header.site-header h1 { margin: 0; font-size: 20px; }

    #map { position: absolute; top: 60px; bottom: 0; width: 100%; }
    #cameraListView { display: none; position: absolute; top: 60px; left: 50%; transform: translateX(-50%); width: 80%; max-width: 600px; bottom: 0; background: #f9f9f9; overflow-y: auto; z-index: 1000; padding: 10px; }

    /* Status indicator */
    .status-dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 6px; vertical-align: middle; }
    .status-dot.online { background: #4caf50; }
    .status-dot.offline { background: #bbb; }

    /* Favorite star */
    .favorite-star { cursor: pointer; margin-left: 6px; color: #ccc; }
    .favorite-star.active { color: #f39c12; }

    /* Preview tooltip */
    .cam-title { position: relative; display: inline-block; }
    .cam-title:hover::after { content: ''; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); width: 160px; height: 90px; background-image: var(--preview); background-size: cover; background-position: center; border: 1px solid #ccc; box-shadow: 0 1px 4px rgba(0,0,0,0.2); } content: ''; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); width: 160px; height: 90px; background-size: cover; background-position: center; border: 1px solid #ccc; box-shadow: 0 1px 4px rgba(0,0,0,0.2); }

    .popup-controls { display: flex; justify-content: space-between; margin: 4px 0; }
    .popup-controls button, .popup-controls select { flex: 1; margin-right: 4px; padding: 4px; font-size: 12px; border: 1px solid #ccc; border-radius: 2px; background: #fff; }
    .popup-controls select { margin-right: 0; }

    .top-bar { position: absolute; top: 70px; left: 16px; z-index: 1100; display: flex; gap: 8px; }
    .top-bar button { padding: 8px; border: none; border-radius: 4px; background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.2); cursor: pointer; font-size: 16px; }
    .top-bar button.active { background: #ddd; }

    .camera-group { margin-bottom: 16px; }
    .group-header { font-weight: bold; cursor: pointer; padding: 4px; background: #eee; border-radius: 4px; }
    .group-list { list-style: none; margin: 0; padding: 0; display: none; }
    .group-list.open { display: block; }
    .camera-item { margin: 8px 0; }

    .cam-video { display: none; position: relative; width: 100%; padding-top: 56.25%; background: #000; margin-top: 8px; }
    .cam-video video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
  </style>
</head>
<body>
  <header class="site-header">
    <h1>Zarcom Cameras Monitoring</h1>
  </header>
  <div class="top-bar">
    <button id="toggleMapBtn" class="active">üó∫Ô∏è Map</button>
    <button id="toggleListBtn">üìã List</button>
  </div>
  <div id="map"></div>
  <div id="cameraListView"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    const cameras = [
      { id: 'BBQ', lat: 34.1602, lng: -118.2547, urlLive: '/hls/cam2.m3u8', preview: '/hls/snap2.jpg' },
      { id: 'Home', lat: 34.20793, lng: -118.36923, urlLive: '/hls/cam10.m3u8', preview: '/hls/snap10.jpg' },
      { id: 'Master BBQ', lat: 34.14667, lng: -118.26278, urlLive: '/hls/cam6.m3u8', preview: '/hls/snap6.jpg' },
      { id: 'Office', lat: 34.1372, lng: -118.3550, urlLive: '/hls/cam1.m3u8', preview: '/hls/snap1.jpg' },
      { id: 'BJ-1', lat: 34.20205, lng: -118.40886, urlLive: '/hls/cam8.m3u8', preview: '/hls/snap8.jpg' },
      { id: 'BJ-2', lat: 34.20225, lng: -118.40866, urlLive: '/hls/cam9.m3u8', preview: '/hls/snap9.jpg' },
      { id: 'Meat Master', lat: 34.19413, lng: -118.36469, urlLive: '/hls/cam11.m3u8', preview: '/hls/snap11.jpg' }
    ];

    // Sort favorites first then alphabetically
    const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    function toggleFavorite(id) {
      const idx = favorites.indexOf(id);
      if (idx === -1) favorites.push(id);
      else favorites.splice(idx, 1);
      localStorage.setItem('favorites', JSON.stringify(favorites));
      buildList();
    // Show list view by default since map logic removed
    document.getElementById('cameraListView').style.display = 'block';
    }

    function buildList() {
      const container = document.getElementById('cameraListView');
      container.innerHTML = '';
      const groups = {};
      cameras.forEach(cam => {
        const letter = cam.id[0].toUpperCase();
        if (!groups[letter]) groups[letter] = [];
        groups[letter].push(cam);
      });
      Object.keys(groups).sort().forEach(letter => {
        const groupDiv = document.createElement('div'); groupDiv.className='camera-group';
        const header = document.createElement('div'); header.className='group-header'; header.textContent = letter;
        const list = document.createElement('ul'); list.className='group-list';
        header.onclick = () => list.classList.toggle('open');
        groups[letter].sort((a,b)=> favorites.includes(b.id)-favorites.includes(a.id) || a.id.localeCompare(b.id)).forEach(cam => {
          const li = document.createElement('li'); li.className='camera-item';
          // status dot (assumed online)
          const dot = document.createElement('span'); dot.className='status-dot online';
          // title with preview on hover
          const title = document.createElement('span'); title.className='cam-title'; title.textContent = cam.id;
          title.style.setProperty('--preview', `url(${cam.preview})`);
          // favorite star
          const star = document.createElement('span'); star.className='favorite-star'; star.innerHTML='‚òÖ';
          if (favorites.includes(cam.id)) star.classList.add('active');
          star.onclick = e=>{ e.stopPropagation(); toggleFavorite(cam.id); };
          const controls = document.createElement('div'); controls.className='popup-controls';
          const liveBtn = document.createElement('button'); liveBtn.textContent='Live';
          const box = document.createElement('div'); box.className='cam-video';
          const vid = document.createElement('video'); vid.controls=true; vid.muted=true;
          box.appendChild(vid);
          liveBtn.onclick = ()=>{ list.querySelectorAll('.cam-video').forEach(v=>v.style.display='none'); box.style.display='block'; attachHls(vid, cam.urlLive); };
          controls.append(liveBtn);
          li.append(dot, title, star, controls, box);
          list.appendChild(li);
        });
        container.append(header, list);
      });
    }

    function attachHls(videoEl, src) {
      if (videoEl._hls) { videoEl._hls.destroy(); delete videoEl._hls; }
      if (Hls.isSupported()) {
        const hls = new Hls(); hls.loadSource(src); hls.attachMedia(videoEl);
        hls.on(Hls.Events.MANIFEST_PARSED, () => videoEl.play());
        videoEl._hls = hls;
      } else { videoEl.src = src; videoEl.onloadedmetadata = ()=>videoEl.play(); }
    }

    // Initialize map similar to before...
    buildList();
  </script>
</body>
</html>
