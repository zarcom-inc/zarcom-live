<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zarcom Cameras Map with Archive</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; }
    header.site-header { position: absolute; top: 0; left: 0; width: 100%; height: 60px; background: #333; color: #fff; display: flex; align-items: center; padding: 0 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); z-index: 1200; }
    header.site-header h1 { margin: 0; font-size: 20px; }

    #cameraListView { display: none; position: absolute; top: 60px; left: 50%; transform: translateX(-50%); width: 80%; max-width: 600px; bottom: 0; background: #f9f9f9; overflow-y: auto; z-index: 1000; padding: 10px; }

    /* Status indicator */
    .status-dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 6px; vertical-align: middle; }
    .status-dot.online { background: #4caf50; }
    .status-dot.offline { background: #bbb; }

    /* Favorite star */
    .favorite-star { cursor: pointer; margin-left: 6px; color: #ccc; }
    .favorite-star.active { color: #f39c12; }

    /* Preview tooltip */
    .cam-title { position: relative; display: inline-block; }
    .cam-title:hover::after { content: ''; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); width: 160px; height: 90px; background-image: var(--preview); background-size: cover; background-position: center; border: 1px solid #ccc; box-shadow: 0 1px 4px rgba(0,0,0,0.2); }

    .popup-controls { display: flex; justify-content: flex-start; margin: 4px 0; gap: 4px; }
    .popup-controls button { padding: 4px 8px; font-size: 12px; border: 1px solid #ccc; border-radius: 2px; background: #fff; cursor: pointer; }

    .camera-group { margin-bottom: 16px; }
    .group-header { font-weight: bold; cursor: pointer; padding: 8px; background: #eee; border-radius: 4px; }
    .group-list { list-style: none; margin: 0; padding: 0 8px; display: none; }
    .group-list.open { display: block; }

    .camera-item { display: flex; align-items: center; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #ddd; }

    .cam-video { display: none; position: relative; width: 100%; padding-top: 56.25%; background: #000; margin-top: 8px; }
    .cam-video video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
  </style>
</head>
<body>
  <header class="site-header">
    <h1>Zarcom Cameras Monitoring</h1>
  </header>
  <div id="cameraListView"></div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    const cameras = [
      { id: 'BBQ', urlLive: '/hls/cam2.m3u8', preview: '/hls/snap2.jpg' },
      { id: 'BJ-1', urlLive: '/hls/cam8.m3u8', preview: '/hls/snap8.jpg' },
      { id: 'BJ-2', urlLive: '/hls/cam9.m3u8', preview: '/hls/snap9.jpg' },
      { id: 'Home', urlLive: '/hls/cam10.m3u8', preview: '/hls/snap10.jpg' },
      { id: 'Master BBQ', urlLive: '/hls/cam6.m3u8', preview: '/hls/snap6.jpg' },
      { id: 'Meat Master', urlLive: '/hls/cam11.m3u8', preview: '/hls/snap11.jpg' },
      { id: 'Office', urlLive: '/hls/cam1.m3u8', preview: '/hls/snap1.jpg' }
    ];

    // Favorites from localStorage
    const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    function toggleFavorite(id) {
      const i = favorites.indexOf(id);
      if (i === -1) favorites.push(id);
      else favorites.splice(i, 1);
      localStorage.setItem('favorites', JSON.stringify(favorites));
      buildList();
    }

    function buildList() {
      const container = document.getElementById('cameraListView');
      container.innerHTML = '';
      const groups = {};
      cameras.forEach(cam => {
        const letter = cam.id[0].toUpperCase();
        if (!groups[letter]) groups[letter] = [];
        groups[letter].push(cam);
      });
      Object.keys(groups).sort().forEach(letter => {
        const group = groups[letter];
        group.sort((a, b) => (favorites.includes(b.id) - favorites.includes(a.id)) || a.id.localeCompare(b.id));
        const div = document.createElement('div'); div.className = 'camera-group';
        const hdr = document.createElement('div'); hdr.className = 'group-header'; hdr.textContent = letter;
        const ul = document.createElement('ul'); ul.className = 'group-list';
        hdr.onclick = () => ul.classList.toggle('open');
        group.forEach(cam => {
          const li = document.createElement('li'); li.className = 'camera-item';
          const left = document.createElement('div');
          const dot = document.createElement('span'); dot.className = 'status-dot online';
          const title = document.createElement('span'); title.className = 'cam-title'; title.textContent = cam.id;
          title.style.setProperty('--preview', `url(${cam.preview})`);
          const star = document.createElement('span'); star.className = 'favorite-star'; star.textContent = 'â˜…';
          if (favorites.includes(cam.id)) star.classList.add('active');
          star.onclick = e => { e.stopPropagation(); toggleFavorite(cam.id); };
          left.append(dot, title, star);
          const right = document.createElement('div'); right.className = 'popup-controls';
          const btn = document.createElement('button'); btn.textContent = 'Live';
          const box = document.createElement('div'); box.className = 'cam-video';
          const vid = document.createElement('video'); vid.controls = true; vid.muted = true;
          box.append(vid);
          btn.onclick = () => { document.querySelectorAll('.cam-video').forEach(v=>v.style.display='none'); box.style.display='block'; attachHls(vid, cam.urlLive); };
          right.append(btn);
          li.append(left, right, box);
          ul.append(li);
        });
        container.append(hdr, ul);
      });
      container.style.display = 'block';
    }

    function attachHls(videoEl, src) {
      if (videoEl._hls) { videoEl._hls.destroy(); }
      if (Hls.isSupported()) {
        const hls = new Hls(); hls.loadSource(src); hls.attachMedia(videoEl);
        hls.on(Hls.Events.MANIFEST_PARSED, () => videoEl.play());
        videoEl._hls = hls;
      } else { videoEl.src = src; videoEl.onloadedmetadata = () => videoEl.play(); }
    }

    // Initial render
    buildList();
  </script>
</body>
</html>
